# Wetube (Youtube í´ë¡ ì½”ë”©)

í”„ë¡ íŠ¸ë¶€í„° ë°±ê¹Œì§€ ëª¨ë‘ ë‹¤ë¤„ë³´ê³  ì‹¶ì–´ Youtube í´ë¡ ì½”ë”© ê°•ì˜ë¥¼ ë³´ë©° ì œì‘í•˜ì˜€ìŠµë‹ˆë‹¤ :)

---

### ğŸŒ í”„ë¡œì íŠ¸ ë§í¬

[Wetube ë°”ë¡œê°€ê¸°](https://wetube.fly.dev/)

---

- ì–¸ì–´ : JavaScript(ES6)
- í”„ë¡ íŠ¸ : SCSS, PUG
- ë°±ì—”ë“œ : NodeJs, MongoDB, Express
- ë°°í¬ : AWS S3, Mongo Atlas, Fly.io
- ë¼ì´ë¸ŒëŸ¬ë¦¬ : npm, WebPack, Mongoose, babel, express-session, multer, FFmpeg ë“±

---

### âš™ï¸ ê¸°ëŠ¥ ì„¤ëª…

- User
  - ê¹ƒí—™ openAPI ë¥¼ ì´ìš©í•œ ì†Œì…œ ë¡œê·¸ì¸ ê¸°ëŠ¥
  - ì„¸ì…˜ì„ í†µí•œ ë¡œê·¸ì¸/ ë¡œê·¸ì•„ì›ƒ ê¸°ëŠ¥
  - í”„ë¡œí•„ ìˆ˜ì •(ì‚¬ì§„, ë‹‰ë„¤ì„ ë“±) ê¸°ëŠ¥
- Video
  - ë™ì˜ìƒ/ ì´ë¯¸ì§€(ì„¬ë„¤ì¼) ì—…ë¡œë“œ ê¸°ëŠ¥(AWS S3)
  - ë™ì˜ìƒ ë…¹í™” ë° ë…¹í™”í•œ ì˜ìƒ ë‹¤ìš´ë¡œë“œ & ì¸ë„¤ì¼ ë‹¤ìš´ë¡œë“œ ê¸°ëŠ¥(FFmpeg)
  - ë™ì˜ìƒ ì¡°íšŒìˆ˜ ê¸°ëŠ¥
  - ë™ì˜ìƒ ìˆ˜ì • ë° ì‚­ì œ ê¸°ëŠ¥
  - (í™”ë©´ì—ì„œ ë³´ì´ëŠ” ì¢‹ì•„ìš”, ì‹«ì–´ìš”ëŠ” ê¸°ëŠ¥ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤..ğŸ¤£)
- ê·¸ ì™¸
  - ëŒ“ê¸€ ì¶”ê°€ ë° ì‚­ì œ ê¸°ëŠ¥
  - ì˜ìƒ ì œëª© ê²€ìƒ‰ ê¸°ëŠ¥

---

### ğŸ“ í”„ë¡œì íŠ¸ êµ¬ì¡°

-ğŸ“‚[src]  
â¡[client] â¡ï¸ js ã€€ã€€â€•ã€€ js í´ë” (videoEvent)  
â¡[client] â¡ï¸ scss ã€€ã€€â€•ã€€ css í´ë”  
â¡[controllers]ã€€ã€€â€•ã€€ì‚¬ìš©ì ìš”ì²­/ì‘ë‹µ ì²˜ë¦¬ í´ë”  
â¡[models]ã€€ã€€â€•ã€€ DB model í´ë”  
â¡[routers]ã€€ã€€â€•ã€€ì‚¬ìš©ì ìš”ì²­/ì‘ë‹µ ë¼ìš°í„° í´ë”  
â¡[views]ã€€ã€€â€•ã€€ PUG í…œí”Œë¦¿ í´ë”  
â¡db.js ã€€ã€€â€•ã€€ mongoose DB ì—°ê²°  
â¡init.js ã€€ã€€â€•ã€€ì„œë²„ ì‹¤í–‰  
â¡middlewares.js ã€€ã€€â€•ã€€ express middleware  
â¡server.js ã€€ã€€â€•ã€€ express ì„œë²„ ì„¸íŒ…

---

### ğŸ“– ë°°ìš´ì ? ì„±ê³¼?

- í•™ì›ì—ì„œ ë°°ì› ë˜ ES5ê°€ ì•„ë‹Œ, ES6 ë²„ì „ì„ ê³µë¶€í•˜ë©°, Arrow function ê³¼ async/await ì™€ ê°™ì€ ë¹„ë™ê¸° í•¨ìˆ˜ ì²˜ë¦¬ì™€ ê°™ì€ ì°¨ì´ì ì— ëŒ€í•´ ì•Œ ìˆ˜ ìˆì—ˆë‹¤.
- FFmpeg ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì‚¬ìš©í•´ ì§ì ‘ ë…¹í™” í›„ ì˜ìƒì„ ë‹¤ìš´ë¡œë“œ ë°›ëŠ” ê¸°ëŠ¥ì„ ë°°ìš¸ ìˆ˜ ìˆì—ˆë‹¤.  
  í•´ë‹¹ ê¸°ëŠ¥ì´ ê¸°ê¸°ì— ë”°ë¼ ê°„í˜¹ ëª¨ë°”ì¼ì—ì„œ ì‘ë™í•˜ì§€ ì•ŠëŠ” ë“¯ í•˜ì—¬ ì—¬ëŸ¬ ê¸°ê³„ë¡œ í…ŒìŠ¤íŠ¸ í›„ ë¬¸ì œê°€ ë°œê²¬ë  ê²½ìš° ë¹ ë¥´ê²Œ ê°œì„ í•  ì˜ˆì •ì…ë‹ˆë‹¤.
- Mongoose ì˜ schema & model ì— ëŒ€í•´ ê³µë¶€í•˜ë©° ë°±ì—”ë“œì˜ êµ¬ì¡°ì— ëŒ€í•´ ë°°ìš¸ ìˆ˜ ìˆì—ˆë‹¤. ì–´ë µì§€ë§Œ ì§ì ‘ ëª¨ë¸ì„ ì„¤ê³„í•˜ê³  êµ¬ì¡°ë¥¼ ì¡ì•„ê°€ëŠ” ê³¼ì •ì´ ì¦ê±°ì› ë‹¤.

---

### â—ê°€ì¥ ì–´ë ¤ì› ë˜ ê²ƒ, í•´ê²° ê¹Œì§€

- MongoDB Atlas + AWS S3 ì„œë²„ë¥¼ ì‚¬ìš©í•˜ëŠ” ê²ƒì€ ì²˜ìŒì´ë‹¤ë³´ë‹ˆ ì–´ë ¤ì›€ì´ ë§ì•˜ì—ˆëŠ”ë°,

      íŠ¹íˆ ë™ì˜ìƒ ë…¹í™” ë° ë³€í™˜ ë¼ì´ë¸ŒëŸ¬ë¦¬ì¸ FFmpeg ì™€ AWS S3 ì˜ **CORS**, header ì •ì±…ì´ ë¶€ë”ªí˜€

      ì •ìƒì ì¸ ì‘ë™ì´ ì•ˆ ë¬ì—ˆë‹¤. ì²˜ìŒ ë§ë˜ CORS ì •ì±… ì˜¤ë¥˜ë¡œ ë¨¸ë¦¬ê°€ í•˜ì–—ê²Œ ë³€í•˜ëŠ” ë“¯ í–ˆë‹¤.

- FFmpeg ëŠ” ë³´ì•ˆì„ ìœ„í•´ ì¶œì²˜ê°„ ê²©ë¦¬ëœ í˜ì´ì§€ì—ì„œë§Œ ì‚¬ìš©ì´ ê°€ëŠ¥í•˜ë‚˜,

      ë‚´ ì•„ë°”íƒ€ URL ì€ AWS S3 ì—ì„œ CROS ë¥¼ í†µí•´ ê°€ì ¸ì™€ì•¼í–ˆë”°.

- ì´ì— AWS S3 ë²„í‚· ì •ì±…ê³¼ ë”ë¶ˆì–´ ì¶”ê°€ë¡œ ì´ˆë©´ì´ì˜€ë˜ CORS ì •ì±…ì— ëŒ€í•´ ì—¬ëŸ¬ ë¬¸ì„œë¥¼ ì°¸ê³ í•˜ê³  ì§ì ‘ ì •ë¦¬í•˜ëŠ” ë“± ë¬¸ì œë¥¼ í•´ê²°í•˜ì˜€ë‹¤.

[ğŸ“•ì—ëŸ¬ë…¸íŠ¸\_CORS ì˜¤ë¥˜ í•´ê²°(2) feat. SharedArrayBuffer](https://velog.io/@tnrud4685/%EC%97%90%EB%9F%AC%EB%85%B8%ED%8A%B8CORS-%EC%98%A4%EB%A5%98-%ED%95%B4%EA%B2%B02...feat.-SharedArrayBuffer)

- ì•„ë˜ëŠ” ë¬¸ì œê°€ ë°œìƒí–ˆë˜ `server.js` ì˜ ë¶€ë¶„.

```jsx
// ê¸°ì¡´ ì½”ë“œ

app.use((req, res, next) => {
  res.setHeader("Access-Control-Allow-Origin", "*");
  res.header("Access-Control-Allow-Credentials", true);
  res.header("Cross-Origin-Embedder-Policy", "credentialless");
  next();
});

// ìˆ˜ì • í›„ ì •ìƒ ë™ì‘

app.use((req, res, next) => {
  res.header("Cross-Origin-Embedder-Policy", "credentialless");
  res.header("Cross-Origin-Opener-Policy", "same-origin");
  next();
});
```

---

### **ğŸ¤¯Â  ë””ë²¨ë¡­ ì˜ˆì •**

- ë„¤ì´ë²„ openAPI ì†Œì…œ ë¡œê·¸ì¸ ê¸°ëŠ¥ êµ¬í˜„
- ë™ì˜ìƒ ì¢‹ì•„ìš”, ì‹«ì–´ìš” ê¸°ëŠ¥
- í•´ì‹œíƒœê·¸ë¥¼ í†µí•´ ì˜ìƒì„ ê²€ìƒ‰í•˜ëŠ” ê¸°ëŠ¥
